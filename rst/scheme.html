

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Scheme &mdash; odelab 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="odelab 0.0.1 documentation" href="../index.html" />
    <link rel="prev" title="Systems" href="system.html" /> 
  </head>
  <body>
<link href='http://fonts.googleapis.com/css?family=Abel|Cabin|Varela|Inconsolata' rel='stylesheet' type='text/css'>
<div class="header-wrapper">
      <div class="header">
        <div class="headertitle"><a
          href="../index.html">odelab 0.0.1 documentation</a></div>
        <div class="rel">
          <a href="system.html" title="Systems"
             accesskey="P">previous</a> |
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

<a href="http://github.com/olivierverdier/odelab">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub">
</a>
    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="scheme">
<span id="scheme-chapter"></span><h1>Scheme<a class="headerlink" href="#scheme" title="Permalink to this headline">¶</a></h1>
<p>The <tt class="xref py py-class docutils literal"><span class="pre">Scheme</span></tt> class may be used to easily create new schemes.</p>
<p>Let us examine the code to create the Explicit Euler scheme:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">odelab</span> <span class="kn">import</span> <span class="n">Scheme</span>

<span class="k">class</span> <span class="nc">ExplicitEuler</span><span class="p">(</span><span class="n">Scheme</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">delta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">h</span><span class="p">,</span> <span class="n">h</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">u0</span><span class="p">)</span>
</pre></div>
</div>
<p>The method <a class="reference internal" href="#odelab.scheme.Scheme.delta" title="odelab.scheme.Scheme.delta"><tt class="xref py py-meth docutils literal"><span class="pre">delta()</span></tt></a> takes as argument the current time <tt class="docutils literal"><span class="pre">t</span></tt> and state <tt class="docutils literal"><span class="pre">u0</span></tt>, as well as the time step <tt class="docutils literal"><span class="pre">h</span></tt>.
It returns a time increment and a state increment.</p>
<p>An object of the class <tt class="xref py py-class docutils literal"><span class="pre">Scheme</span></tt> has access to the attribute <tt class="xref py py-attr docutils literal"><span class="pre">system</span></tt>, which gives access to the system at hand.</p>
<p>If the method is implicit, all you have to do is to implement the <tt class="xref py py-meth docutils literal"><span class="pre">get_residual()</span></tt> method instead.
Here is an example showing how to implement the Implicit Euler scheme:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ImplicitEuler</span><span class="p">(</span><span class="n">Scheme</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_residual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">residual</span><span class="p">(</span><span class="n">du</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">du</span> <span class="o">-</span> <span class="n">h</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="n">h</span><span class="p">,</span> <span class="n">u0</span><span class="o">+</span><span class="n">du</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">residual</span>
</pre></div>
</div>
<div class="section" id="main-methods">
<h2>Main Methods<a class="headerlink" href="#main-methods" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="#odelab.scheme.Scheme" title="odelab.scheme.Scheme"><tt class="xref py py-class docutils literal"><span class="pre">odelab.scheme.Scheme</span></tt></a> class provides several methods to assist the creation of numerical schemes.</p>
<div class="section" id="explicit-schemes">
<h3>Explicit Schemes<a class="headerlink" href="#explicit-schemes" title="Permalink to this headline">¶</a></h3>
<p>The method <a class="reference internal" href="#odelab.scheme.Scheme.delta" title="odelab.scheme.Scheme.delta"><tt class="xref py py-meth docutils literal"><span class="pre">delta()</span></tt></a> may be used to directly provide the difference <span class="math">\(u_1 - u_0\)</span>.
This is typically useful for explicit scheme.
See for instance <a class="reference internal" href="#odelab.scheme.classic.RungeKutta4" title="odelab.scheme.classic.RungeKutta4"><tt class="xref py py-class docutils literal"><span class="pre">odelab.scheme.classic.RungeKutta4</span></tt></a>, or <a class="reference internal" href="#odelab.scheme.classic.ExplicitEuler" title="odelab.scheme.classic.ExplicitEuler"><tt class="xref py py-class docutils literal"><span class="pre">odelab.scheme.classic.ExplicitEuler</span></tt></a>.</p>
</div>
<div class="section" id="implicit-schemes">
<h3>Implicit Schemes<a class="headerlink" href="#implicit-schemes" title="Permalink to this headline">¶</a></h3>
<div class="section" id="general-residual">
<h4>General Residual<a class="headerlink" href="#general-residual" title="Permalink to this headline">¶</a></h4>
<p>For implicit schemes, the method <a class="reference internal" href="#odelab.scheme.Scheme.get_residual" title="odelab.scheme.Scheme.get_residual"><tt class="xref py py-meth docutils literal"><span class="pre">get_residual()</span></tt></a> simply returns the residual of a function which root is the difference <span class="math">\(u_1 - u_0\)</span>.
In other words, the residual is a function <span class="math">\(F\)</span> such that</p>
<div class="math">
\[F(u_1 - u_0) = 0\]</div>
</div>
<div class="section" id="custom-residual">
<h4>Custom Residual<a class="headerlink" href="#custom-residual" title="Permalink to this headline">¶</a></h4>
<p>Sometimes, the residual&#8217;s root is not the difference <span class="math">\(u_1 - u_0\)</span>, and <tt class="docutils literal"><span class="pre">odelab</span></tt> supports that as well.
The best way to understand how it works is to look at the implementation of <a class="reference internal" href="#odelab.scheme.Scheme.delta" title="odelab.scheme.Scheme.delta"><tt class="xref py py-meth docutils literal"><span class="pre">delta()</span></tt></a>, which uses <a class="reference internal" href="#odelab.scheme.Scheme.get_residual" title="odelab.scheme.Scheme.get_residual"><tt class="xref py py-meth docutils literal"><span class="pre">get_residual()</span></tt></a>.</p>
<p>In short, the method <tt class="docutils literal"><span class="pre">delta</span></tt> runs a nonlinear solver on the residual provided by <tt class="docutils literal"><span class="pre">get_residual</span></tt>, using a guess provided by <a class="reference internal" href="#odelab.scheme.Scheme.get_guess" title="odelab.scheme.Scheme.get_guess"><tt class="xref py py-meth docutils literal"><span class="pre">get_guess()</span></tt></a>.
The root is then passed to the method <a class="reference internal" href="#odelab.scheme.Scheme.reconstruct" title="odelab.scheme.Scheme.reconstruct"><tt class="xref py py-meth docutils literal"><span class="pre">reconstruct()</span></tt></a>, which job is to construct the difference <span class="math">\(u_1 - u_0\)</span> from the root of the residual.</p>
<p>This flexibility is useful, for instance, if only one part of the method is implicit.</p>
</div>
</div>
</div>
<div class="section" id="time-adaptivity">
<h2>Time Adaptivity<a class="headerlink" href="#time-adaptivity" title="Permalink to this headline">¶</a></h2>
<p>The methods <a class="reference internal" href="#odelab.scheme.Scheme.delta" title="odelab.scheme.Scheme.delta"><tt class="xref py py-meth docutils literal"><span class="pre">delta()</span></tt></a>, <a class="reference internal" href="#odelab.scheme.Scheme.get_residual" title="odelab.scheme.Scheme.get_residual"><tt class="xref py py-meth docutils literal"><span class="pre">get_residual()</span></tt></a> or <a class="reference internal" href="#odelab.scheme.Scheme.step" title="odelab.scheme.Scheme.step"><tt class="xref py py-meth docutils literal"><span class="pre">step()</span></tt></a> have <tt class="docutils literal"><span class="pre">h</span></tt> as a parameter, but it is just a convenience.
The time step parameter is in fact stored by the <a class="reference internal" href="#odelab.scheme.Scheme" title="odelab.scheme.Scheme"><tt class="xref py py-class docutils literal"><span class="pre">Scheme</span></tt></a> object itself.
A time adaptive scheme may thus change the next time step, or even implement advanced time-step control.</p>
<p>An example of time-adaptive scheme is given by <a class="reference internal" href="#odelab.scheme.classic.RungeKutta34" title="odelab.scheme.classic.RungeKutta34"><tt class="xref py py-class docutils literal"><span class="pre">RungeKutta34</span></tt></a>.</p>
</div>
<div class="section" id="initialization-and-external-solvers">
<h2>Initialization and External Solvers<a class="headerlink" href="#initialization-and-external-solvers" title="Permalink to this headline">¶</a></h2>
<p>It is the user&#8217;s responsibility to initialize the scheme object appropriately.
Usually, the only necessary argument is the time-step:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ie</span> <span class="o">=</span> <span class="n">ImplicitEuler</span><span class="p">(</span><span class="n">h</span><span class="o">=.</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the solver calls the <a class="reference internal" href="#odelab.scheme.Scheme.initialize" title="odelab.scheme.Scheme.initialize"><tt class="xref py py-meth docutils literal"><span class="pre">initialize()</span></tt></a> method before running the simulation.
At this stage, the solver object has been initialized, and in particular has a initial condition and a <tt class="xref py py-class docutils literal"><span class="pre">System</span></tt> object.
This is especially useful for using external numerical schemes, as those often require the right hand side and initial conditions to be known at initialization.
An example of scheme using an external numerical scheme is given by <a class="reference internal" href="#odelab.scheme.ode15s" title="odelab.scheme.ode15s"><tt class="xref py py-class docutils literal"><span class="pre">ode15s</span></tt></a>, which uses SciPy&#8217;s function <tt class="docutils literal"><span class="pre">odeint</span></tt>.</p>
</div>
<div class="section" id="family-of-numerical-schemes">
<h2>Family of Numerical Schemes<a class="headerlink" href="#family-of-numerical-schemes" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">odelab</span></tt> comes with a variety of numerical schemes to be used out of the box.
For instance:</p>
<blockquote>
<div><ul class="simple">
<li>generic Runge-Kutta methods</li>
<li>generic linear multi-step methods</li>
<li>generic explicit general linear methods</li>
<li>generic exponential methods</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="classical-numerical-scheme">
<h2>”Classical“ Numerical Scheme<a class="headerlink" href="#classical-numerical-scheme" title="Permalink to this headline">¶</a></h2>
<p>A collection of classical numerical scheme described in all the basic textbooks on differential equations.</p>
<span class="target" id="module-odelab.scheme.classic"></span><dl class="class">
<dt id="odelab.scheme.classic.ExplicitEuler">
<em class="property">class </em><tt class="descclassname">odelab.scheme.classic.</tt><tt class="descname">ExplicitEuler</tt><big>(</big><em>h=None</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#odelab.scheme.classic.ExplicitEuler" title="Permalink to this definition">¶</a></dt>
<dd><p>Explicit version of the Euler method, defined by:</p>
<div class="math">
\[u_1 = u_1 + hf(t_0, u_0)\]</div>
</dd></dl>

<dl class="class">
<dt id="odelab.scheme.classic.ImplicitEuler">
<em class="property">class </em><tt class="descclassname">odelab.scheme.classic.</tt><tt class="descname">ImplicitEuler</tt><big>(</big><em>h=None</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#odelab.scheme.classic.ImplicitEuler" title="Permalink to this definition">¶</a></dt>
<dd><p>The standard implicit Euler scheme, defined by:</p>
<div class="math">
\[u_1 = u_0 + hf(t_1, u_1)\]</div>
</dd></dl>

<dl class="class">
<dt id="odelab.scheme.classic.RungeKutta34">
<em class="property">class </em><tt class="descclassname">odelab.scheme.classic.</tt><tt class="descname">RungeKutta34</tt><big>(</big><em>h=None</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#odelab.scheme.classic.RungeKutta34" title="Permalink to this definition">¶</a></dt>
<dd><p>Adaptive Runge-Kutta of order four.</p>
</dd></dl>

<dl class="class">
<dt id="odelab.scheme.classic.RungeKutta4">
<em class="property">class </em><tt class="descclassname">odelab.scheme.classic.</tt><tt class="descname">RungeKutta4</tt><big>(</big><em>h=None</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#odelab.scheme.classic.RungeKutta4" title="Permalink to this definition">¶</a></dt>
<dd><p>Standard Runge-Kutta of order 4.</p>
</dd></dl>

</div>
<div class="section" id="module-odelab.scheme">
<span id="the-scheme-class"></span><h2>The <tt class="xref py py-class docutils literal"><span class="pre">Scheme</span></tt> class<a class="headerlink" href="#module-odelab.scheme" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="odelab.scheme.Scheme">
<em class="property">class </em><tt class="descclassname">odelab.scheme.</tt><tt class="descname">Scheme</tt><big>(</big><em>h=None</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#odelab.scheme.Scheme" title="Permalink to this definition">¶</a></dt>
<dd><p>General Scheme class. Subclass this class to define a specific integration method.</p>
<dl class="method">
<dt id="odelab.scheme.Scheme.adjust_stepsize">
<tt class="descname">adjust_stepsize</tt><big>(</big><em>error</em><big>)</big><a class="headerlink" href="#odelab.scheme.Scheme.adjust_stepsize" title="Permalink to this definition">¶</a></dt>
<dd><p>Change the step size based on error estimation.
To be overridden for a variable step size method.</p>
</dd></dl>

<dl class="method">
<dt id="odelab.scheme.Scheme.delta">
<tt class="descname">delta</tt><big>(</big><em>t</em>, <em>u0</em>, <em>h</em><big>)</big><a class="headerlink" href="#odelab.scheme.Scheme.delta" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the difference between current and next state.</p>
</dd></dl>

<dl class="method">
<dt id="odelab.scheme.Scheme.get_guess">
<tt class="descname">get_guess</tt><big>(</big><em>t</em>, <em>u0</em>, <em>h</em><big>)</big><a class="headerlink" href="#odelab.scheme.Scheme.get_guess" title="Permalink to this definition">¶</a></dt>
<dd><p>Default guess for the Newton iterations, assuming that the residual has the same size as u.</p>
</dd></dl>

<dl class="method">
<dt id="odelab.scheme.Scheme.get_residual">
<tt class="descname">get_residual</tt><big>(</big><em>t</em>, <em>u0</em>, <em>h</em><big>)</big><a class="headerlink" href="#odelab.scheme.Scheme.get_residual" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the residual, which root is u1 - u0.</p>
</dd></dl>

<dl class="method">
<dt id="odelab.scheme.Scheme.initialize">
<tt class="descname">initialize</tt><big>(</big><em>events</em><big>)</big><a class="headerlink" href="#odelab.scheme.Scheme.initialize" title="Permalink to this definition">¶</a></dt>
<dd><p>Called the first time the scheme is used during a simulation.</p>
</dd></dl>

<dl class="method">
<dt id="odelab.scheme.Scheme.reconstruct">
<tt class="descname">reconstruct</tt><big>(</big><em>root</em>, <em>t</em>, <em>u0</em>, <em>h</em><big>)</big><a class="headerlink" href="#odelab.scheme.Scheme.reconstruct" title="Permalink to this definition">¶</a></dt>
<dd><p>Default reconstruction function. It assumes that the root is already delta u.</p>
</dd></dl>

<dl class="attribute">
<dt id="odelab.scheme.Scheme.root_solver">
<tt class="descname">root_solver</tt><a class="headerlink" href="#odelab.scheme.Scheme.root_solver" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <tt class="xref py py-class docutils literal"><span class="pre">FSolve</span></tt></p>
</dd></dl>

<dl class="method">
<dt id="odelab.scheme.Scheme.step">
<tt class="descname">step</tt><big>(</big><em>t</em>, <em>u0</em>, <em>h</em><big>)</big><a class="headerlink" href="#odelab.scheme.Scheme.step" title="Permalink to this definition">¶</a></dt>
<dd><p>Implementation of the Compensated Summation algorithm as described in <a class="reference internal" href="#haluwa06">[HaLuWa06]</a> §VIII.5.</p>
<table class="docutils citation" frame="void" id="haluwa06" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[HaLuWa06]</a></td><td>Hairer, Lubich, Wanner <em>Geometric Numerical Integration</em>, Springer, 2006.</td></tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="odelab.scheme.ode15s">
<em class="property">class </em><tt class="descclassname">odelab.scheme.</tt><tt class="descname">ode15s</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#odelab.scheme.ode15s" title="Permalink to this definition">¶</a></dt>
<dd><p>Simulation of matlab&#8217;s <tt class="docutils literal"><span class="pre">ode15s</span></tt> solver.
It is a BDF method of max order 5</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="solver.html">Solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="system.html">Systems</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Scheme</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#main-methods">Main Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="#time-adaptivity">Time Adaptivity</a></li>
<li class="toctree-l2"><a class="reference internal" href="#initialization-and-external-solvers">Initialization and External Solvers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#family-of-numerical-schemes">Family of Numerical Schemes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#classical-numerical-scheme">”Classical“ Numerical Scheme</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-odelab.scheme">The <tt class="docutils literal"><span class="pre">Scheme</span></tt> class</a></li>
</ul>
</li>
</ul>

          <h3 style="margin-top: 1.5em;">Search</h3>
          <form class="search" action="../search.html" method="get">
            <input type="text" name="q" />
            <input type="submit" value="Go" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
          <p class="searchtip" style="font-size: 90%">
            Enter search terms or a module, class or function name.
          </p>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <a href="system.html" title="Systems"
             >previous</a> |
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../genindex.html" title="General Index"
             >index</a>
            <br/>
            <a href="../_sources/rst/scheme.txt"
               rel="nofollow">Show Source</a>
        </div>
		<div>
			<a href="http://www.mathjax.org/">
  <img title="Powered by MathJax"
       src="http://www.mathjax.org/badge.gif"
       border="0" alt="Powered by MathJax" />
   </a>
   </div>

        <div class="right">
          
    <div class="footer">
        &copy; Copyright 2010–2012, Olivier Verdier.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1pre.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>